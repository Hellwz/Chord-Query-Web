<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>和弦查询器</title>
</head>
<body>
    <div>
        <h4>和弦名称</h4>
        <input id="t1" type="text" style="width: 200px; height: 18px">  
        <button onclick="query();">查询</button>
    </div>
    <br>
    <canvas id="myCanvas" width="1000px" height="400px" style="border:1px solid #d3d3d3;"></canvas>
    <br>
    <p>
        使用说明：<br>
        --- 输入和弦名称（区分大小写），点击查询即可获得和弦位置。例如输入“C”并点击查询，将在键盘上显示“C大三和弦”的位置。<br>
        --- 字母与数字含义：“m”小三和弦；“aug”增三和弦；“dim”减三和弦；“7”或“dom7”（属）七和弦；
        “maj7”或“M7”大七和弦；“m7”小七和弦；“aug7”增七和弦；“dim7”减七和弦；
        “7-5”七减五和弦；“m7-5”半减七和弦；“mM7”小大七和弦；“augM7”增大七和弦；
        “6”六和弦；“46”四六和弦；
        “9”（属）九和弦；“m9”小九和弦；“maj9”大九和弦；十一和弦、十三和弦类似；<br>
        --- 支持“add”、“sus”、“/”，升降号需放在音名之前（升号#，降号b）。<br>
        --- 如在使用过程中发现问题或有好的建议请在主页留言板留言，谢谢。
    </p>
    <div>
        <a href="https://wzw21.cn">回到首页</a>
    </div>
    
    <script lang="javascript">
        var c=document.getElementById("myCanvas");
        var ctx=c.getContext("2d");
        var board_img=new Image();
        board_img.src="keyboard.png";
        board_img.onload = function() {
            ctx.drawImage(board_img,0,0);
        }

        var base = 0;
        function draw_point(key_id)
        {
            console.log(key_id);
            var color = "red";
            if (key_id > 12 && key_id <= 24)
            {
                key_id -= 12;
                base = 497.5;
            } 
            else base = 0;

            if (key_id > 24)
            {
                key_id -= 24;
                color = "purple";
            }
           
            ctx.beginPath();
            switch (key_id)
            {
                case 1:ctx.arc(38 + base, 354, 20, 0, Math.PI*2, true); break;
                case 2:ctx.arc(70 + base, 232, 18, 0, Math.PI*2, true); break;
                case 3:ctx.arc(109 + base, 354, 20, 0, Math.PI*2, true); break;
                case 4:ctx.arc(147 + base, 232, 18, 0, Math.PI*2, true); break;
                case 5:ctx.arc(180 + base, 354, 20, 0, Math.PI*2, true); break;
                case 6:ctx.arc(252 + base, 354, 20, 0, Math.PI*2, true); break;
                case 7:ctx.arc(282 + base, 232, 18, 0, Math.PI*2, true); break;
                case 8:ctx.arc(323 + base, 354, 20, 0, Math.PI*2, true); break;
                case 9:ctx.arc(357 + base, 232, 18, 0, Math.PI*2, true); break;
                case 10:ctx.arc(394 + base, 354, 20, 0, Math.PI*2, true); break;
                case 11:ctx.arc(431 + base, 232, 18, 0, Math.PI*2, true); break;
                case 12:ctx.arc(465 + base, 354, 20, 0, Math.PI*2, true); break;
            } 
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        } 
        
        function get_start(input)
        {
            var start = 0;
            if (input[0] == 'C')
            {
                start = 1;
                input = input.substring(1);
            }
            if (input.substring(0,2) == '#C' || input.substring(0,2) == 'bD')
            {
                start = 2;
                input = input.substring(2);
            }
            if (input[0] == 'D')
            {
                start = 3;
                input = input.substring(1);
            }
            if (input.substring(0,2) == '#D' || input.substring(0,2) == 'bE')
            {
                start = 4;
                input = input.substring(2);
            }
            if (input[0] == 'E')
            {
                start = 5;
                input = input.substring(1);
            }
            if (input[0] == 'F')
            {
                start = 6;
                input = input.substring(1);
            }
            if (input.substring(0,2) == '#F' || input.substring(0,2) == 'bG')
            {
                start = 7;
                input = input.substring(2);
            }
            if (input[0] == 'G')
            {
                start = 8;
                input = input.substring(1);
            }
            if (input.substring(0,2) == '#G' || input.substring(0,2) == 'bA')
            {
                start = 9;
                input = input.substring(2);
            }
            if (input[0] == 'A')
            {
                start = 10;
                input = input.substring(1);
            }
            if (input.substring(0,2) == '#A' || input.substring(0,2) == 'bB')
            {
                start = 11;
                input = input.substring(2);
            }
            if (input[0] == 'B')
            {
                start = 12;
                input = input.substring(1);
            }
            return {start, input};
        }

        function query()
        {
            ctx.clearRect(0,0,c.width,c.height); 
            ctx.drawImage(board_img,0,0);

            var input = document.getElementById("t1").value;
            var chord = [-1,-1,-1,-1,-1,-1,-1,-1];
            var start = 0;
            
            var ret = get_start(input);
            start = ret.start;
            input = ret.input;
            console.log(start);
            console.log(input);

            if (start == 0) return;

            var tmp = ''
            if (input.search('sus') != -1)
            {
                loc = input.search('sus');
                tmp = input.substring(loc);
                input = input.substring(0,loc);
            }  
            if (input.search('add') != -1)
            {
                loc = input.search('add');
                tmp = input.substring(loc);
                input = input.substring(0,loc);
            }
            if (input.search('/') != -1)
            {
                loc = input.search('/')
                tmp = input.substring(loc);
                input = input.substring(0,loc);
            }

            if (input == ''||input == 'maj') //大三和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 7;
            }
            if (input == 'm') //小三和弦
            {
                chord[0] = 0;
                chord[1] = 3;
                chord[2] = 7;
            }
            if (input == 'aug') //增三和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 8;
            }
            if (input == 'dim') //减三和弦
            {
                chord[0] = 0;
                chord[1] = 3;
                chord[2] = 6;
            }
            if (input == '7' || input == 'dom7') //属七和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 7;
                chord[3] = 10;
            }
            if (input == 'm7') //小七和弦
            {
                chord[0] = 0;
                chord[1] = 3;
                chord[2] = 7;
                chord[3] = 10;
            }
            if (input == 'maj7' || input == 'M7') //大七和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 7;
                chord[3] = 11;
            } 
            if (input == 'aug7') //增七和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 8;
                chord[3] = 10;
            } 
            if (input == 'dim7') //减七和弦
            {
                chord[0] = 0;
                chord[1] = 3;
                chord[2] = 6;
                chord[3] = 9;
            }
            if (input == '7b5' || input == '7-5') //七减五和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 6;
                chord[3] = 10;
            }
            if (input == 'm7b5' || input == 'm7-5') //小七减五和弦（半减七和弦）
            {
                chord[0] = 0;
                chord[1] = 3;
                chord[2] = 6;
                chord[3] = 10;
            } 
            if (input == 'mM7') //小大七和弦
            {
                chord[0] = 0;
                chord[1] = 3;
                chord[2] = 7;
                chord[3] = 11;
            } 
            if (input == 'augM7') //增大七和弦 
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 8;
                chord[3] = 11;
            } 
            if (input == '6' || input == 'maj6') //六和弦
            {
                /*chord[0] = 0;
                chord[1] = 4;
                chord[2] = 7;
                chord[3] = 9;*/
                chord[0] = 4;
                chord[1] = 7;
                chord[2] = 12;
            }   
            if (input == 'm6') //小六和弦
            {
                /*chord[0] = 0;
                chord[1] = 3;
                chord[2] = 7;
                chord[3] = 9;*/
                chord[0] = 3;
                chord[1] = 7;
                chord[2] = 12;
            }  
            if (input == '46') //四六和弦
            {
                chord[0] = 7;
                chord[1] = 12;
                chord[2] = 16;
            }
            if (input == 'm46')
            {
                chord[0] = 7;
                chord[1] = 12;
                chord[2] = 15;
            }
            if (input == '9') //（属）九和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 7;
                chord[3] = 10;
                chord[4] = 14;
            }    
            if (input == 'm9') //小九和弦
            {
                chord[0] = 0;
                chord[1] = 3;
                chord[2] = 7;
                chord[3] = 10;
                chord[4] = 14;
            }
            if (input == 'maj9') //大九和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 7;
                chord[3] = 11;
                chord[4] = 14;
            }
            if (input == '11') //（属）十一和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 7;
                chord[3] = 10;
                chord[4] = 14;
                chord[5] = 17;
            } 
            if (input == 'm11') //小十一和弦
            {
                chord[0] = 0;
                chord[1] = 3;
                chord[2] = 7;
                chord[3] = 10;
                chord[4] = 14;
                chord[5] = 17;
            } 
            if (input == 'maj11') //大十一和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 7;
                chord[3] = 11;
                chord[4] = 14;
                chord[5] = 17;
            } 
            if (input == '13') //（属）十三和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 7;
                chord[3] = 10;
                chord[4] = 14;
                chord[5] = 17;
                chord[6] = 21;
            }    
            if (input == 'm13') //小十三和弦
            {
                chord[0] = 0;
                chord[1] = 3;
                chord[2] = 7;
                chord[3] = 10;
                chord[4] = 14;
                chord[5] = 17;
                chord[6] = 21;
            } 
            if (input == 'maj13') //大十三和弦
            {
                chord[0] = 0;
                chord[1] = 4;
                chord[2] = 7;
                chord[3] = 11;
                chord[4] = 14;
                chord[5] = 17;
                chord[6] = 21;
            } 

            if (tmp.substring(0,3) == 'add')
            {
                if (tmp[3] == '2') chord[7] = 2;
                if (tmp[3] == '4') chord[7] = 5;
                if (tmp[3] == '6') chord[7] = 9;
                if (tmp[3] == '8') chord[7] = 12;
                if (tmp[3] == '9') chord[7] = 14;
                if (tmp.substring(3,5) == '11') chord[7] = 17;
                if (tmp.substring(3,5) == '13') chord[7] = 21;
            }
            
            if (tmp == 'sus') tmp = 'sus4';
            if (tmp.substring(0,3) == 'sus')
            {
                if (tmp[3] == '2') chord[1] = 2;
                if (tmp[3] == '4') chord[1] = 5;
            }
            
            var new_start = start + chord[0];
            if (tmp[0] == '/')
            {
                ret = get_start(tmp.substring(1));
                new_start = ret.start;
                tmp = ret.input;
            }

            for (var i = 0; i < 8; i++)
            {
                if (i == 0 && new_start != start + chord[i]) //处理根音变化
                {
                    draw_point(new_start);
                    continue;
                }
                if (chord[i] != -1) 
                {
                    draw_point(start + chord[i]);
                }
            }
        }
    </script>
</body>
</html>
